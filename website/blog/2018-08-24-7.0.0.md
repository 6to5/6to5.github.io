---
layout: post
title:  "Babel 7 Released"
author: Henry Zhu
authorURL: https://twitter.com/left_pad
date: ¬† 2018-08-24 18:00:00
categories: announcements
share_text: "Babel 7 Released"
---

After over 1.5 years, 4k commits, over 50 pre-releases, and a lot of help we are excited to announce the release of Babel 7. It's been almost [3 years](https://babeljs.io/blog/2015/10/29/6.0.0) since the release of Babel 6! There's a lot of moving parts so please bear with us in the first weeks of release.

<!-- truncate -->

## The Wait is Over üéâ

Software is never going to be perfect but we're ready to ship something that's already been used in production for some time now! [`@babel/core`](https://www.npmjs.com/package/@babel/core) is already at 5.1 mil downloads/month because of it's usage in tools like [Next.js 6](https://zeit.co/blog/next6), [vue-cli 3.0](https://medium.com/the-vue-point/vue-cli-3-0-is-here-c42bebe28fbb), [React Native 0.56](https://facebook.github.io/react-native/blog/2018/07/04/releasing-react-native-056), and even [Wordpress's frontend](https://github.com/Automattic/wp-calypso) üôÇ!

## Babel's Role

I'd like to start this post by re-introducing Babel's role in web development over the last few years.

The original issue was that unlike in server languages, there was no way to guarantee a particular version of JavaScript because each user that visits a website could be on a different browser.

Babel provided a way for developers to write the latest JavaScript syntax all while allowing them not to worry about how to make it backwards compatible for their users by translating it.

Because of it's ability to transform JavaScript code, it also can be used to implement new features: thus it has become a bridge to help TC39 get feedback on proposed JavaScript ideas and for the community to have a say in the future of the language.

Babel has been pretty ubiquitous in web development over the last year. We currently have: [1.3 million dependent repos on GitHub](https://github.com/babel/babel/network/dependents), [17 million downloads on npm per month](https://www.npmjs.com/package/babel-core), and [hundreds of users](http://babeljs.io/users) and almost every framework (React, Vue, Ember, Polymer). It has become a such a foundation for web development such that many people don't even know it's being used. Even if you aren't using it yourself, it's highly likely youre dependencies are.

Because of this, Babel has a huge influence on not just the future of the language itself but it's community and ecosystem. But despite all this, Babel is just a community driven project by a couple of volunteers.

## A Call for Support

> TODO

As much as this is an announcement post, it's also an opportunity to explain and remind the state of this project.

## Some Major Breaking Changes

> Everything should be documented in our [Migration Guide](http://babeljs.io/docs/en/next/v7-migration). Many of these changes can be done automatically with our new [`babel-upgrade`](https://github.com/babel/babel-upgrade) tool.

- Drop support for un-maintained Node versions: 0.10, 0.12, 4, 5 ([details](http://babeljs.io/blog/2017/09/12/planning-for-7.0#drop-support-for-unmaintained-node-versions-010-012-5-4315-https-githubcom-babel-babel-issues-4315))
- Move us to the `@babel` namespace by switching to using "scoped" packages ([details](http://babeljs.io/blog/2017/12/27/nearing-the-7.0-release#renames-scoped-packages-babel-x)). This helps differentiate official packages, so `babel-core` becomes `@babel/core` (and no squatting)
- Remove (and stop publishing) any yearly presets (`preset-es2015`, etc) ([details](http://babeljs.io/blog/2017/12/27/nearing-the-7.0-release#deprecated-yearly-presets-eg-babel-preset-es20xx)). [`@babel/preset-env`](https://babeljs.io/docs/en/next/babel-preset-env.html) replaces the need for these as it includes all yearly additions as well as the ability to target a specific set of browsers
- Also drop the ["Stage"](https://tc39.github.io/process-document/) presets (`@babel/preset-stage-0`, etc) in favor of opting into individual proposals. Similarly remove proposals from `@babel/polyfill` by default ([details](https://github.com/babel/babel/pull/8440)). Please consider reading the whole [post](https://babeljs.io/blog/2018/07/27/removing-babels-stage-presets) on this for more explanation.
- Some packages have renames: any TC39 proposal plugin will now be `-proposal` instead of `-transform` ([details](http://babeljs.io/blog/2017/12/27/nearing-the-7.0-release#renames-proposal)). So `@babel/plugin-transform-class-properties` becomes `@babel/plugin-proposal-class-properties`.
- Introduce a `peerDependency` on `@babel/core` for certain user-facing packages (e.g. `babel-loader`, `@babel/cli`, etc) ([details](http://babeljs.io/blog/2017/12/27/nearing-the-7.0-release#peer-dependencies-integrations))

## JavaScript Config Files

We are introducing [`babel.config.js`](https://babeljs.io/docs/en/next/babelconfigjs.html).

`*.js` configuration files are fairly common in the JavaScript ecosystem. ESLint and Webpack both allow for `.eslintrc.js` and `webpack.config.js` configuration files, respectively.

Note that this doesn't mean that it replaces writing a config with `.babelrc` or in `package.json`. It isn't a requirement, but having this may be useful in certain cases. Below is the case of only compiling with a plugin in "production".

```js
var env = process.env.NODE_ENV;
module.exports = {
  plugins: [
    env === "production" && "babel-plugin-that-is-cool"
  ].filter(Boolean)
};
```

`babel.config.js` has a different config resolution than a `.babelrc`. It will always resolve everything from that file vs. originally when Babel would do a lookup from each file upward until it found a config. This makes it possible to take advantage of the next feature posted below, `overrides`.

<!-- What does this line mean? Could it's meaning be made more clear? -->
<!-- Henry: maybe we can just remove it, didn't want to over emphasize `.babelrc.js` when we want people to use babel.config.js -->
JavaScript files are also valid for `.babelrc` logic as well.

## Selective Configuration with `overrides`

I published a [post](https://babeljs.io/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages) a while back on thoughts on both publishing ES2015+ packages and also consuming/compiling them.

There's a [section](https://babeljs.io/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages#selective-compilation-with-overrides) that goes into using a new key in Babel's config called `overrides` which allows you to specify different configs per glob.

```javascript=
module.exports = {
  presets: [
    // defeault config...
  ],
  overrides: [{
    test: ["./node_modules"],
    presets: [
      // config for node_modules
    ],
  }, {
    test: ["./tests"],
    presets: [
      // config for tests
    ],
  }]
};
```

The application may require different compilation configs for the tests, client code, and server code and this allows that behavior without having to make a new `.babelrc` file per folder.

## Speed üèé

Babel itself is [faster](https://twitter.com/left_pad/status/927554660508028929) so it should take less time to build! We've made a lot of changes to optimize the code as well as [accept](https://twitter.com/bmeurer/status/924346958810107904) [patches](https://twitter.com/rauchg/status/924349334346276864) from the [v8](https://twitter.com/v8js) team. We're glad to be a part of the [Web Tooling Benchmark](https://github.com/v8/web-tooling-benchmark) alongside many other great JavaScript tools.

### Output Options

Babel has supported [preset and plugin options](https://babeljs.io/docs/en/next/plugins#plugin-options) for some time now. To recap you can wrap the plugin in an array and pass an options object to the plugin:

```diff
{
  "plugins": [
-   "pluginA",
+   ["pluginA", {
+     // options here
+   }],
  ]
}
```

We've made a some changes to the `loose` option of some plugins and added some new options for others! Note by using these options you are opting into non-spec compliant behavior and should know what you are doing; this can become an issue when you switch off of compiling to use the syntax natively. These kinds of options are best used in a library, if at all.

- For classes, `class A {}` will now not include the `classCallCheck` helper.

```javascript
class A {}
```

```diff
var A = function A() {
-  _classCallCheck(this, A);
};
```

- There is a new option if every use of a `for-of` loop is just an array: `["transform-for-of", { "assumeArray": true }]`

```javascript
let elm;
for (elm of array) {
  console.log(elm);
}
```

```javascript
let elm;

for (let _i = 0, _array = array; _i < _array.length; _i++) {
  elm = _array[_i];
  console.log(elm);
}
```

- We exclude the `transform-typeof-symbol` plugin in `loose` mode for `preset-env` [#6831](https://github.com/babel/babel/pull/6831)

We've found a lot of libraries doing this already so we decided to do this by default.

Note that the default behavior is to be as spec compliant as possible so that switching off of Babel or using `preset-env` is seamless vs. allowing smaller output just to save bytes (there's a tradeoff there that each project can make), and we will towards better docs and tooling to make that easier.

### "Pure" Annotation Support

After #6209, ES6 classes that are transpiled will have a ``/*#__PURE__*/`` comment that minfiers like [`Uglify`](https://github.com/mishoo/UglifyJS2) and [`babel-minify`](https://github.com/babel/minify) can use for dead code elimination. These annotations are added to other helper functions as well.

```js
class C {
  m() {}
}
```

```js
var C =
/*#__PURE__*/
function () {
  // ...
}();
```

There might be more opportunities for this kind of output, let us know!

## Syntax

### [TC39 Proposals](https://github.com/tc39/proposals) Support

I'd like to re-iterate that [we've removed the Stage presets](https://babeljs.io/blog/2018/07/27/removing-babels-stage-presets) in favor of a policy of asking users to explicitly opt-in proposals < Stage 4.

The concern is that we are automatically opt-ing people into syntax that is not fixed or done with the expectation that it will not changed. But this is not the case, especially for proposals that are Stage 0 or 1. This [post](https://babeljs.io/blog/2018/07/19/whats-happening-with-the-pipeline-proposal) explains a bit on the kind of thinking behind newer ideas.

Here's a smaller listing of some new syntax Babel supports (keep in mind this feature set is a moving target that could be added/removed/stalled) and which ones have been added in v7:

- ES2018: [Object Rest Spread](https://babeljs.io/docs/en/next/babel-plugin-proposal-object-rest-spread) (`var a = { b, ...c }`)
- ES2018 (new): [Unicode Property Regex](https://babeljs.io/docs/en/next/babel-plugin-proposal-unicode-property-regex)
- ES2018 (new): [JSON Superset](https://babeljs.io/docs/en/next/babel-plugin-proposal-json-strings) 
- ES2015 (new): [`new.target`](https://babeljs.io/docs/en/next/babel-plugin-transform-new-target)
- Stage 3 (new): [Class Private Instance Fields](https://babeljs.io/docs/en/next/babel-plugin-proposal-class-properties) (`class A { #b = 2 }`)
- Stage 3 (WIP): [Static Class Fields, Private Static Methods](https://github.com/babel/babel/issues/8052) (`class A { static #a() {} }`)
- Stage 3 (new): [Optional Catch Binding](https://babeljs.io/docs/en/next/babel-plugin-proposal-optional-catch-binding) `try { throw 0 } catch { do() }`
- Stage 3 (new): [BigInt](https://babeljs.io/docs/en/next/babel-plugin-syntax-bigint) (syntax only)
- Stage 3: [Dynamic Import](https://babeljs.io/docs/en/next/babel-plugin-syntax-dynamic-import) (`import("a")`)
- Stage 2 (new): [`import.meta`](https://babeljs.io/docs/en/next/babel-plugin-syntax-import-meta) (syntax only) (`import.meta.url`)
- Stage 2 (new): [Numeric Seperators](https://babeljs.io/docs/en/next/babel-plugin-proposal-numeric-separator) (`1_000`)
- Stage 2 (new): [`function.sent`](https://babeljs.io/docs/en/next/babel-plugin-proposal-function-sent)
- Stage 2: [`export-namespace-from`](https://babeljs.io/docs/en/next/babel-plugin-proposal-export-namespace-from) (`export * as ns from 'mod'`), split from `export-extensions`
- Stage 2: Decorators. Check below for an update on our progress!
- Stage 1: [`export-default-from`](https://babeljs.io/docs/en/next/babel-plugin-proposal-export-default-from) (`export v from 'mod'`), split from `export-extensions`
- Stage 1 (new): [Optional Chaining](https://babeljs.io/docs/en/next/babel-plugin-proposal-optional-chaining) (`a?.b`)
- Stage 1 (new): [Logical Assignment](https://babeljs.io/docs/en/next/babel-plugin-proposal-logical-assignment) (`a &&= b; a ||= b`)
- Stage 1 (new): [Nullish Coalescing](https://babeljs.io/docs/en/next/babel-plugin-proposal-nullish-coalescing) (`a ?? b`)
- Stage 1 (new): [Pipeline Operator](https://babeljs.io/docs/en/next/babel-plugin-proposal-pipeline-operator) (`a |> b`)
- Stage 1 (new): [Throw Expressions](https://babeljs.io/docs/en/next/babel-plugin-proposal-throw-expressions) (`() => throw new Error("a")`)

> It's hard for anyone to keep track of all the proposals, so we attempt to do that at [babel/proposals](https://github.com/babel/proposals/).

### TypeScript Support (`@babel/preset-typescript`)

> TODO: should do a fun example instead, link to TS post (ping Daniel)

```typescript
interface Person {
    firstName: string;
    lastName: string;
}

function greeter(person : Person) {
    return "Hello, " + person.firstName + " " + person.lastName;
}
```

We worked with the [TypeScript](https://github.com/Microsoft/TypeScript) team on getting Babel to parse/transform type syntax with `@babel/preset-typescript`, similar to how we handle [Flow](https://flow.org/) with `@babel/preset-flow`.

Both Flow and Typescript are tools that enable JavaScript users to take advantage of gradual typing, and we'd like to enable both in Babel. This also means that we expect help from both their teams at FB and Microsoft as well as the community for help in maintaining this compatibility over time. Even had the opportunity to meetup with people on both teams in-person a while back!

> This integration is fairly new, so it's possible some syntax isn't supported fully. We'd appreciate your help in [reporting issues and maybe sending a PR](https://github.com/babel/babel/labels/area:%20typescript?page=2&q=is%3Aopen+label%3A%22area%3A+typescript%22)!

### JSX Fragment Support (`<>`)

As mentioned in the [React Blog](https://reactjs.org/blog/2017/11/28/react-v16.2.0-fragment-support.html), JSX Fragment support has been available as of `beta.31`.

```jsx
render() {
  return (
    <>
      <ChildA />
      <ChildB />
    </>
  );
}

// output üëá

render() {
  return React.createElement(
    React.Fragment,
    null,
    React.createElement(ChildA, null),
    React.createElement(ChildB, null)
  );
}
```

## Babel Helpers Changes

> The [babel-upgrade PR](https://github.com/babel/babel-upgrade/pull/71) is in progress

`@babel/runtime` has been split up into `@babel/runtime` and `@babel/runtime-corejs2` ([PR](https://github.com/babel/babel/pull/8266)). The former only contains Babel's helper functions and the latter contains that as well as any polyfill functions (e.g. `Symbol`, `Promise`).

Babel may need to inject certain functions into the code that can re-used. We just call these "helper functions" just like functions that are shared between modules.

An example of this is with compiling a `class` (without `loose` mode on): 

The specification says that you need to call a class with `new Person()` but if it's compiled to a function you could technically just do `Person()` so we include a runtime check for this.

```js
class Person {}
```

```js
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Person = function Person() {
  _classCallCheck(this, Person);
};
```

With `@babel/plugin-transform-runtime` and `@babel/runtime` (as a dependency), Babel can extract the individual functions and just require the modular functions to enable smaller output like so:

```js
var _classCallCheck = require("@babel/runtime/helpers/classCallCheck");

var Person = function Person() {
  _classCallCheck(this, Person);
};
```

The same can be done with `external-helpers` and `rollup-plugin-babel`. We are looking into seeing if we can automatically do this in the future. Look out for a standalone post on Babel's helpers soon.

## Automatic Polyfilling

Polyfills are necessary for enabling features like `Promise`, `Symbol`, if supported browsers don't enable them. This is important when differentiating between what Babel does as a compiler (transforms *syntax*) vs. a polyfill (implements built-in functions/objects).

It's easy enough to just import something that covers everything like `@babel/polyfill`:

```js
import "@babel/polyfill";
```

But it includes the whole polyfill, and you may not need to import everything if browsers support it already. This is the same problem that `@babel/preset-env` tries to solve with syntax, so we apply it here with polyfills. The option `useBuiltins: "entry"` does this by splitting the original import into the imports that are necessary.

But we can do better by only importing the polyfills that are used in the codebase. The option `"useBuiltIns: "usage"` is our first attempt at enabling something like that ([docs](https://babeljs.io/docs/en/next/babel-preset-env#usebuiltins)).

It will run through each file and inject an import at the top of each file if that built-in is "used" in the code. For example:

```js
import "core-js/modules/es6.promise";
var a = new Promise();
```

The inference isn't perfect so there may be false positives.

```js
import "core-js/modules/es7.array.includes";
a.includes // assume a is an []
```

Other ideas in this space are to use [polyfill.io](https://polyfill.io) if you are ok with relying on a service (or read how [Kent C. Dodds](https://twitter.com/kentcdodds) used that to [build a hosted service at PayPal](https://blog.kentcdodds.com/polyfill-as-needed-with-polyfill-service-35f0ff306a26)).

## Misc

### Babel Macros üé£

One of the best parts of Babel is the pluggability of the tool. Over the years, Babel it has ceased being an "6to5" compiler and became a code transform platform, enabling some fantastic optimizations for both user and developer experience. [Tons of babel plugins have been developed](https://www.npmjs.com/search?q=keywords%3Ababel%20plugin) for specific libraries and use cases to improve performance and capabilities of library APIs that would not be possible otherwise (some "libraries" are completely transpiled away resulting in no runtime at all).

Unfortunately, adding these plugins to your codebase requires changing configuration (which some toolkits like [create-react-app](https://github.com/facebook/create-react-app) don't allow) and it adds complexity to your code because developers have to know what babel plugins are operating on a file to know what will happen to the code they're writing. These problems have been solved by (the [Sunil Pai](https://twitter.com/threepointone) inspired) [babel-plugin-macros](https://github.com/kentcdodds/babel-plugin-macros) by [Kent C. Dodds](https://twitter.com/kentcdodds)!

Once that `babel-plugin-macros` has been installed and [added to your config](https://github.com/kentcdodds/babel-plugin-macros/blob/master/other/docs/user.md) (it's included in `create-react-app` v2), you don't need to bother with your configuration to use the many macros which have been [published to npm](https://www.npmjs.com/search?q=keywords:babel-plugin-macros) already. In addition, it's even easier to [write your own custom transforms](https://github.com/kentcdodds/babel-plugin-macros/blob/master/other/docs/author.md) for use cases specific to your app or one part of your code.

Here's a very simple example of a custom macro that swaps `line` and `column` imports with the line or column where it appears in the code:

```javascript
// line-column.macro
module.exports = createMacro(lineColumnMacro)

function lineColumnMacro({ references, babel }) {
  references.line.forEach(referencePath => {
    const num = referencePath.node.loc.start.line
    referencePath.replaceWith(babel.types.numberLiteral(num))
  })
  references.column.forEach(referencePath => {
    const num = referencePath.node.loc.start.column
    referencePath.replaceWith(babel.types.numberLiteral(num))
  })
}
```

```javascript
import {line, column} from './line-column.macro'

console.log(`we're at ${line}:${column}`)
console.log(`and now we're at ${line}:${column}`)
```

This will be transpiled into:

```javascript
console.log(`we're at ${3}:${32}`)
console.log(`and now we're at ${4}:${40}`)
```

And we don't need to change any config to add that custom transform. Writing and using code transforms is a fair amount easier this way. You can't do everything that a full babel plugin can do, but we're only just getting started with this and look forward to what the community will do with this power.

> Play around with the above macro example [on astexplorer.net](https://astexplorer.net/#/gist/e586bcbbf2ce35835115a7d808528c90/b64f5f025d98481ebfb93a582334c8562f7337f0). See if you can make it support an import called `lineColumn` that is replaced with the sum of line and column. Just for fun!


Learn more about babel-plugin-macros in our post ["Zero-config code transformation with babel-plugin-macros"](https://babeljs.io/blog/2017/09/11/zero-config-with-babel-macros).

### `class C extends HTMLElement {}`

> One of our oldest issues gets it's own heading ([details](https://github.com/babel/babel/pull/7020))

Babel has always had this caveat where it could not support extending native built-ins (`Array`, `Error`, etc) and now it can! We've gotten a lot of issues about this; üéâ you should celebrate like [Andrea](https://twitter.com/WebReflection/status/940724280035303430)!

This change is made to the class plugin so it should be automatically enabled if you are using `preset-env`.

### Website Changes üåè

We've moved our site from [Jekyll](https://jekyllrb.com/) to [Docusaurus](https://docusaurus.io/)!

We're still in the process of setting up [translations](https://github.com/babel/website/issues/1619) with [Crowdin](https://crowdin.com/project/babeljs), and with Babel 7 out, we will be in a better place to start that process.

#### REPL

![](https://i.imgur.com/j0qOllj.png)

We've rewritten the [REPL](https://babeljs.io/repl) as a [React Component](https://github.com/babel/website/tree/master/js/repl), and have been working with Ives on integrating better with [CodeSandbox](https://codesandbox.io/).

We're participating in [Rails Girls Summer of Code](https://railsgirlssummerofcode.org/) again! This time, [Gyujin](https://twitter.com/MarinaGJCho) and [Sujin](https://twitter.com/sujinleeme) have been working hard to integrate [Boopathi's](https://twitter.com/heisenbugger) [babel-time-travel](https://github.com/babel/babel-time-travel) into the REPL which you can already test now!

There are so many opportunities here to get involved in make teaching how Babel, [ASTs](https://en.wikipedia.org/wiki/AST), and other tools work better!

### We Have A Song üé∂

> Hallelujah‚ÄîIn Praise of Babel

One day, [Angus](https://twitter.com/angustweets) graciously imparted to us a [song](https://medium.com/@angustweets/hallelujah-in-praise-of-babel-977020010fad) which I thought was amazing, so why not make it our "official" song? And [Shawn](https://twitter.com/swyx) made a brilliant cover [here](https://www.youtube.com/watch?v=40abpedBKK8).

You can find it in our repo at [SONG.md](https://github.com/babel/babel/blob/master/SONG.md). We hope to see other projects follow up on this!

## What's Next?

> TODO

- We are almost finished implementing [the new decorators proposal](https://github.com/babel/babel/pull/7976) in Babel thanks to [Nicol√≤](). It has been a long journey (it has taken [more than one year](https://github.com/babel/babel/pull/6107#issue-135801160)!) because the new proposal is completely different and much more powerful than the old one, but it is almost there :tada:. You can expect it to be released in one of the next minor versions, alongside with a blog post which will explain the changes in detail.
- There are a lot of new features in the works: plugin ordering, better validation/errors, speed, re-thinking loose/spec options, caching, using Babel asynchronously.

## Open Source is a Mirror

>TODO

## Thanks

>TODO

This is a really exciting release, much more so knowing how much time and effort was put into making it happen over the last year.

Personally I've never really put so much of my mental energy into anything of this magnitude and I'd like to thank so many people for lifting us up along the way.

If you appreciate this post and the work we're doing on Babel, you can support me on [Patreon](https://www.patreon.com/henryzhu), ask your company to sponsor Babel on [Open Collective](https://opencollective.com/babel), and also get your company involved with Babel as part of your work. We'd appreciate the collective ownership of this vital project in the frontend community!